<script type="text/javascript" charset="utf-8">
var $container = $('#last_show');
var arts = new Array();
var i = 0;
var div = 0;
<% cache("#{@cache}", :expires_in => 1.hour) do %>
  <% @arts = @search.results %>
  <% i = 0 %>
  <% @arts.each do |art| %>
    arts[<%= i %>] = '<%= escape_javascript(link_to image_tag(art.image.url(:splash).to_s, :alt => art.name, :title => art.name), art_profile_path(:slug => art.slug)) %>';
    <% i = i + 1 -%>
  <% end %>
<% end %>

function addImage() {
  var newDiv = document.createElement('div')
  $(newDiv).addClass("bimg").attr('id', div).html(arts[i]);
  $container.prepend(newDiv);

  var dd = div - 8;
  if($("div#"+ dd).length) {
    $("div#"+ dd).remove();
  }
  
  console.log(i);
  i++;
  div++;
  if(i == arts.length) {
    i = 0;
  }
}  

$(document).ready(function(){

  $("#last_show img").tipsy({
    live: true,
    trigger: 'hover',
    gravity: 'w'
  });

  $container.masonry({
    itemSelector : 'div.bimg',
    gutterWidth: 0,
    isAnimated: true,
    columnWidth: 165
  });
  for(a =0; a<= 2; a++){
    addImage();
  }
  setTimeout(function() {
   $container.masonry('reload'); 
  }, 500);
  setInterval(function(){
    addImage();
    $container.masonry('reload');
    }, 10000);
});

</script>